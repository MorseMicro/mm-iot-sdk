<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Morse Micro IoT SDK: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="favicon.svg" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Morse Micro IoT SDK
   &#160;<span id="projectnumber">2.7.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('GETTING_STARTED.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Getting Started </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md__root_workspace_build_mhs_binaries_mhs_res_doc_gettingstarted"></a></p>
<p >This getting started guide walks through the process of using the MM-IoT-SDK Framework. This will go through the process of setting up the software infrastructure, building firmware for the EKH08, and loading it onto the device.</p>
<blockquote class="doxtable">
<p >&zwj;Note that the MM-IoT-SDK Framework is meant for more advanced users. For a simpler experience it is suggested to use PlatformIO. See <code>MM USERGUIDE - Platform IO</code> for details. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md58"></a>
Prerequisites</h1>
<ul>
<li>The Morse Micro IoT SDK software package</li>
<li>A <a class="el" href="MMPLATFORMS.html">Morse Micro IoT Reference Platforms</a></li>
<li>A development PC running Linux. The following instructions are for a PC running <b>Ubuntu 22.04 (x86 64bit)</b></li>
</ul>
<h1><a class="anchor" id="UNPACKING_THE_SW"></a>
Unpacking the software package</h1>
<p >The first step is to create an appropriate directory and unzip the software package into it. For example: </p><pre class="fragment">unzip mm-iot-sdk-&lt;VER&gt;.zip -d mm-iot-sdk-&lt;VER&gt;
cd mm-iot-sdk-&lt;VER&gt;/framework
</pre><p> Where <code>&lt;VER&gt;</code>= is the package version number. The instructions below assume that the current working directory is <code>mm-iot-sdk-&lt;VER&gt;/framework</code>.</p>
<dl class="section warning"><dt>Warning</dt><dd>The zip file does not contain a root folder, so take care to use the <code>-d</code> parameter when unzipping or unzip into an empty directory.</dd></dl>
<h1><a class="anchor" id="autotoc_md59"></a>
Package contents</h1>
<p >The following is a brief overview of the contents of the MM-IoT-SDK package as it relates to using the framework. There are additional files that are used for PlatformIO that we will be ignoring.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Path   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>framework/doc/</code>   </td><td class="markdownTableBodyNone">HTML documentation, including Getting Started Guide and API documentation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>framework/mk/</code>   </td><td class="markdownTableBodyNone">Makefile fragments for the various SDK components    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>framework/morsefirmware/</code>   </td><td class="markdownTableBodyNone">Firmware and board configuration files for supported Morse Micro chips and modules    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>framework/morselib/</code>   </td><td class="markdownTableBodyNone">Headers and .a files for morselib. <code>Libraries can be found under morselib/lib/&lt;architecture&gt;</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>framework/src/freertos/</code>   </td><td class="markdownTableBodyNone">FreeRTOS source code    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>framework/src/hostap/</code>   </td><td class="markdownTableBodyNone">WPA Supplicant source code    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>framework/src/lwip/</code>   </td><td class="markdownTableBodyNone">Lightweight IP source code    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>framework/src/platforms/</code>   </td><td class="markdownTableBodyNone">Platform-specific code. Includes relevant MCU BSP code, Hardware Abstraction Layer shims, Operating System abstraction layer shim.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>framework/tools/</code>   </td><td class="markdownTableBodyNone">Various host tools    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>examples/</code>   </td><td class="markdownTableBodyNone">Example applications in source form. Note not all platforms support all examples due to memory constraints   </td></tr>
</table>
<h1><a class="anchor" id="GETTING_STARTED_DEV_PC_SETUP"></a>
Development PC setup</h1>
<p >Provided in the SDK package is a script to install the prerequisite software on a <b>Ubuntu 22.04</b> PC. This may work with other Ubuntu/Debian distributions but your mileage may vary.</p>
<p >The script can be run as follows: </p><pre class="fragment">./tools/setupscripts/ubuntu-setup.sh
</pre><p> This script installs some packages in <code>/opt/morse</code>. If you have already connected the development board, unplug the USB cable for 5 seconds and plug it in again after running the script. This will cause the new device permissions to take effect.</p>
<p >A shell script is provided that adds the necessary directories to the PATH. This can be sourced as follows: </p><pre class="fragment">. ./tools/setupscripts/env.sh
</pre><p> The above script needs to be run for every terminal instance. For a more permanent solution, you can add this to the initialization script for your shell, in which case it will not need to be run manually. For example, if you are using the default shell (bash) on <b>Ubuntu 22.04</b>, you can add a line like the following to the file <code>.bashrc</code> in your home directory. Note that you will need to substitute <code>$HOME/mm-iot-sdk-&lt;VER&gt;</code> with the appropriate name of the directory where you unpacked the SDK package. </p><pre class="fragment">. $HOME/mm-iot-sdk-&lt;VER&gt;/framework/tools/setupscripts/env.sh
</pre><p> After making the above change to .bashrc you will need to log out and log back in again for this to take effect.</p>
<h2><a class="anchor" id="autotoc_md60"></a>
Python environment</h2>
<blockquote class="doxtable">
<p >&zwj;All the python scripts in the Morse Micro IoT SDK have been validated with <b>Python3.10</b> (default for <b>Ubuntu 22.04</b>). Your mileage may vary if you use a different version. </p>
</blockquote>
<p>As part of the SDK there are a number of python scripts used as tools (<a class="el" href="GETTING_STARTED.html#SET_APP_CONFIGURATION">Setting Application Configuration</a>) or to drive example applications (<a class="el" href="emmet_8c.html#EMMET_APP_HOWTO">How to use the Emmet example application</a>). In order to maximise the chances of these scripts working seamlessly on your machine we utilise a tool called <a href="https://pipenv.pypa.io/">Pipenv</a>. It is a tool used to automatically create and manage a virtualenv. The virtualenv used for the SDK is define by the Pipfile located in the root of the <code>mm-iot-sdk-&lt;VER&gt;</code> directory.</p>
<p >To create the virtual env run: </p><pre class="fragment">pipenv sync
</pre><p> You can run python scripts from the virtualenv in two ways:</p><ol type="1">
<li><code>pipenv shell</code>. This will drop you into a shell in the virtual env from which you can run your python scripts as normal.</li>
<li><code>pipenv run ./tools/your-script.py</code> . This will run the script in the virtual env and then exit.</li>
</ol>
<blockquote class="doxtable">
<p >&zwj;The <code>pipenv</code> commands must be run from the same directory as the Pipfile that defines the virtualenv. If you do not do this a new virtualenv will be defined without the required packages. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md61"></a>
AP configuration</h1>
<p >This version of the IoT SDK has been tested against Morse Micro AP with software version 1.13.1. It is assumed that you have this configured and within range of your <a class="el" href="MMPLATFORMS.html">Morse Micro IoT Reference Platforms</a>.</p>
<h1><a class="anchor" id="autotoc_md62"></a>
Application overview</h1>
<p >This SDK includes several example applications, source code for which can be found in the <code>mm-iot-sdk-&lt;VER&gt;/examples/&lt;example&gt;</code> directory. For more detail about each of the example applications see the <a class="el" href="MMAPPS.html">Example Applications</a> page.</p>
<p >In the following sections we will be going over some of the common elements that you will see in most if not all example applications. We will be using the ping application as an example.</p>
<h2><a class="anchor" id="autotoc_md63"></a>
Ping Example Application Structure</h2>
<p >This is a brief overview of the ping example application structure, it is not a substitute for reading the source code.</p>
<p >Below is a quick overview of some key files in the example application directory.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">File   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="ping_8c.html" title="Simple ping demonstration.">src/ping.c</a></code>   </td><td class="markdownTableBodyNone">This is the main entry point for the application code and contains the core ping logic    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>src/mm_app_common.c</code>   </td><td class="markdownTableBodyNone">This is a common module used by a number of example apps for initializing the network interface    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>config.hjson</code>   </td><td class="markdownTableBodyNone">Configuration file used for populating the <a class="el" href="group__MMCONFIG.html">Morse Micro Persistent Configuration Store</a> module    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>targets/&lt;platform&gt;/Makefile</code>   </td><td class="markdownTableBodyNone">Makefile to build the example application for the supported platforms   </td></tr>
</table>
<h2><a class="anchor" id="APP_CONFIGURATION"></a>
Application Configuration</h2>
<p >There are a number of configuration parameters that can be used to change how the applications operate. Note these are not all the possible parameters just the key ones for the ping application, see <code>mm-iot-sdk-&lt;VER&gt;/examples/&lt;application&gt;/config.hjson</code> for the full list.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Configuration Params   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>wlan.country_code</code>   </td><td class="markdownTableBodyNone">Two character country code. For an up-to-date list of supported country codes in the supplied regulatory database, see the reference implementation <code>mm_app_regdb.c</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>wlan.ssid</code>   </td><td class="markdownTableBodyNone">SSID of the AP to connect to.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>wlan.password</code>   </td><td class="markdownTableBodyNone">The Wi-Fi password, not required if <code>wlan.security</code> is open.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>wlan.security</code>   </td><td class="markdownTableBodyNone">The Wi-Fi security to use, valid values are sae, owe and open.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ping.target</code>   </td><td class="markdownTableBodyNone">IP address of the remote device (e.g., AP) to ping.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ping.count</code>   </td><td class="markdownTableBodyNone">Number of ping packets to send.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ping.size</code>   </td><td class="markdownTableBodyNone">Size of ping payload in bytes.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ping.interval</code>   </td><td class="markdownTableBodyNone">Interval (in ms) between successive ping requests.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>bcf_file</code>   </td><td class="markdownTableBodyNone">Board configuration .mbin file to use.   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md64"></a>
MMConfig Application configuration</h3>
<p >The preferred method of configuring the application is using the <a class="el" href="group__MMCONFIG.html">Morse Micro Persistent Configuration Store</a> module. The main advantage here is that we only have to build the binary once to get a variety of different combinations. An example might be that you would like to ping a different remote IP, you can just modify the value in the <a class="el" href="group__MMCONFIG.html">Morse Micro Persistent Configuration Store</a> and reboot the application (by pressing the reset button).</p>
<blockquote class="doxtable">
<p >&zwj;The values stored in the <a class="el" href="group__MMCONFIG.html">Morse Micro Persistent Configuration Store</a> module will take preference over any configuration parameters set using the legacy method. </p>
</blockquote>
<p>Instructions for loading values into <a class="el" href="group__MMCONFIG.html">Morse Micro Persistent Configuration Store</a> can be found in <a class="el" href="GETTING_STARTED.html#SET_APP_CONFIGURATION">Setting Application Configuration</a>. </p>
<h3><a class="anchor" id="autotoc_md65"></a>
Legacy Application Configuration</h3>
<p >The legacy method to configure the application is to use a <code>#define</code> for each parameter. These will be ignored if the corresponding <a class="el" href="group__MMCONFIG.html">Morse Micro Persistent Configuration Store</a> parameter is set.</p>
<p >The location of the defines are in two places.</p>
<p ><code>mm-iot-sdk-&lt;VER&gt;/examples/ping/src/ping.c</code> contains the defines specific to the ping application.</p>
<p ><code>mm-iot-sdk-&lt;VER&gt;/examples/ping/src/mm_app_loadconfig.c</code> contains the defines relating the wlan/network configuration.</p>
<h1><a class="anchor" id="BUILDING_FIRMWARE"></a>
Building Firmware</h1>
<blockquote class="doxtable">
<p >&zwj;We will be building for the <code>mm-ekh08-u575</code> platform but the same steps apply for all platforms. Just run make from the corresponding directory. </p>
</blockquote>
<p>To build the ping example application, first change into the example directory, <code>mm-iot-sdk-&lt;VER&gt;/examples/ping/targets/mm-ekh08-u575</code> then invoke the following command: </p><pre class="fragment">make -j4
</pre><p> Where 4 specifies the number of parallel threads to run and can be substituted for a value appropriate to your platform.</p>
<p >The result of the above command will be a <code>ping.elf</code> file in the <code>build/</code> directory for the ping example application.</p>
<h1><a class="anchor" id="PROGRAMMING_FIRMWARE"></a>
Programming</h1>
<blockquote class="doxtable">
<p >&zwj;As mentioned in the <a class="el" href="GETTING_STARTED.html#UNPACKING_THE_SW">Unpacking the software package</a> section, its is assumed that you will be running the following commands from the <code>mm-iot-sdk-&lt;VER&gt;/framework</code> directory. You will need to open multiple terminal windows when going through the following steps. We recommend using some kind of tiling terminal emulator such as <a href="https://gnunn1.github.io/tilix-web/">Tilix</a> but this is not required. </p>
</blockquote>
<p>The Nucleo has an onboard ST-LINK debugger/programmer that operates over USB. The ST-LINK provides both a debug interface and a USB serial port, the latter of which is used for log messages. The GNU Debugger (GDB) is used for debugging, with OpenOCD providing the interface between the GDB and the hardware, as shown in the diagram below.</p>
<div class="image">
<img src="stlink-stackup.png" alt=""/>
<div class="caption">
Block diagram of debugging hardware/software stack</div></div>
 <p >Connect the Nucleo's to the development PC following the instructions on the <a class="el" href="MMPLATFORMS.html">Morse Micro IoT Reference Platforms</a> page. To verify that it has enumerated, run lsub as follows: </p><pre class="fragment">lsusb | grep STM
</pre><p> This should result in output similar to the following: </p><pre class="fragment">Bus 003 Device 081: ID 0483:374e STMicroelectronics STLINK-V3
</pre> <h2><a class="anchor" id="autotoc_md66"></a>
Launching Miniterm</h2>
<p >Miniterm is a python based console application that allows us to monitor and interact with a serial interface. There are many other options such as minicom or putty that you can use if you so wish. However, your milage may vary if you decided to use another application.</p>
<p >Open a new terminal and execute the following command to find the path to the ST-LINK serial port: </p><pre class="fragment">ls /dev/serial/by-id/usb-STMicroelectronics_*
</pre><p> This will list the ST-LINK serial port devices connected to the PC.</p>
<p >To start Miniterm, execute the following command, substituting XXX for the actual value from the output of the ls command above: </p><pre class="fragment">miniterm /dev/serial/by-id/usb-STMicroelectronics_XXX 115200
</pre><p> Leave Miniterm running, this is where we will view the output from the application after programing the device.</p>
<h2><a class="anchor" id="GETTING_STARTED_OPENOCD"></a>
Launching OpenOCD</h2>
<p >Open On-Chip Debugger (OpenOCD) is an open-source application that provides debugging, in-system programming and boundary-scan testing for embedded target devices. We will be using it to configure and program the host processor.</p>
<p >First of all, follow the instructions in <a class="el" href="GETTING_STARTED.html#GETTING_STARTED_DEV_PC_SETUP">Development PC setup</a> to ensure that the correct OpenOCD bin directory is in your path.</p>
<p >To verify that the correct OpenOCD is in the path, execute the following command: </p><pre class="fragment">which openocd
</pre><p> If you have followed the instructions in <a class="el" href="GETTING_STARTED.html#GETTING_STARTED_DEV_PC_SETUP">Development PC setup</a> then the result of this command should be as follows: </p><pre class="fragment">/opt/morse/xpack-openocd-0.12.0-2/bin/openocd
</pre><p> To launch OpenOCD, first open a new terminal and change into the IoT SDK directory. Execute: </p><pre class="fragment">openocd -f src/platforms/mm-ekh08-u575/openocd.cfg
</pre><p> Leave OpenOCD running as we will be using it in the following steps.</p>
<blockquote class="doxtable">
<p >&zwj;Note that the <code>openocd.cfg</code> will vary for each platform. </p>
</blockquote>
<h2><a class="anchor" id="SET_APP_CONFIGURATION"></a>
Setting Application Configuration</h2>
<blockquote class="doxtable">
<p >&zwj;First, follow the instructions in <a class="el" href="GETTING_STARTED.html#GETTING_STARTED_DEV_PC_SETUP">Development PC setup</a> to ensure that <a href="https://pipenv.pypa.io/">Pipenv</a> virtualenv is created. </p>
</blockquote>
<p>As mentioned in the <a class="el" href="GETTING_STARTED.html#APP_CONFIGURATION">Application Configuration</a> section, each application has a number of configuration variables that modify the behavior of the application.</p>
<p >Most config store fields have default values specified, but there are two important fields that must be specified explicitly. The <code>wlan.country_code</code> field must be set to the 2 letter code for your applicable regulatory domain, and the <code>bcf_file</code> field must specify the path to the appropriate Board Configuration File. Refer to the <code>config.hjson</code> file in the example application directory for details specific to each application.</p>
<p >The Board Configuration File (BCF) is a configuration file for the Morse Micro chip that provides board-specific information and is required for the system to function properly. BCFs for Morse Micro modules are included in the MM-IoT-SDK package. These modules can be identified by the part numbers printed on their labels, which take the form MM6108-MFxxxxxx.</p>
<dl class="section note"><dt>Note</dt><dd>That the MM-IoT-SDK uses a different format for the BCF. It uses a more space efficient <code>.mbin</code> (Morse binary) format. This differs from the format used for the Linux driver so you cannot use those BCFs here.</dd></dl>
<p>All configuration values are stored as key-value pairs in the <a class="el" href="group__MMCONFIG.html">Morse Micro Persistent Configuration Store</a> section of the MCU flash. To simplify programming of these values we provide a python script that allows you to write, read and delete values. To see a full list of capabilities the following command can be run to see a help menu: </p><pre class="fragment">pipenv run ./tools/platform/program-configstore.py -h
</pre><p> For this example we are going to write the values using the <code>config.hjson</code> file provided with the ping example application. You will need to remove the leading <code>//</code> from in front of the <code>wlan.country_code</code> and <code>bcf_file</code> values. Replacing them with appropriate values for you country and device.</p>
<p >Once those values have been updated you can run the following command to load the values onto the device. </p><pre class="fragment">pipenv run ./tools/platform/program-configstore.py -H localhost write-json ../examples/ping/config.hjson
</pre><p> To confirm that the correct values have been loaded the following command can be run to dump the contents of the <a class="el" href="group__MMCONFIG.html">Morse Micro Persistent Configuration Store</a> section. </p><pre class="fragment">pipenv run ./tools/platform/program-configstore.py -H localhost -d
</pre><p> The expected output (note the exact contents will vary slightly depending on BCF and country). </p><pre class="fragment">2023-10-23 16:06:13 WARNING: Failed to read config store partition 1 at 0x08006000: Invalid signature found

Partition 0 (current)
=====================

  Version 1

  Key                              | Value
  ---------------------------------|--------
  wlan.ssid                        | MorseMicro
  wlan.password                    | 12345678
  wlan.security                    | sae
  wlan.country_code                | AU
  ip.dhcp_enabled                  | false
  ip.ip_addr                       | 192.168.1.2
  ip.netmask                       | 255.255.255.0
  ip.gateway                       | 192.168.1.1
  ip6.autoconfig                   | true
  ping.target                      | 192.168.1.1
  ping.count                       | 10
  ping.interval                    | 1000
  ping.size                        | 56
  bcf_file                         | 008004004d4d424300812801efbeadde7e66a50e04000200180100000000 ...
</pre><p> The above process should only need to be performed once, since the sectors used by <a class="el" href="group__MMCONFIG.html">Morse Micro Persistent Configuration Store</a> should not be affected by normal application programming. Note, that these values may need to be updated if you update the version of the Morse Micro IoT SDK used. The most likely value that will need to be updated is the <code>bcf_file</code>.</p>
<h3><a class="anchor" id="autotoc_md67"></a>
Additional steps for the mm-ekh08-wb55 platform</h3>
<blockquote class="doxtable">
<p >&zwj;This is not relevant for other platforms </p>
</blockquote>
<p>The <a class="el" href="MMPLATFORMS.html#mm-ekh08-wb55">mm-ekh08-wb55 Platform</a> is slightly more complex in that it has a main CPU (M4) as well as a second CPU (M0+) that is used for its RF functionality. The chip will reserve a portion of the flash for exclusive use by CPU2. This means that the position of the last sector (available to CPU1) may change.</p>
<p >By default it is assumed that CPU2 will not be used and any FW will be deleted, moving the last available flash sector to offset 0xF3. To ensure this is the case you will need to use the <a href="https://www.st.com/en/development-tools/stm32cubeprog.html">STM32CubeProgrammer</a> to delete any CPU2 firmware that may have been loaded onto the device. The following steps will assume you have the <a class="el" href="MMPLATFORMS.html#mm-ekh08-wb55">mm-ekh08-wb55 Platform</a> connected to the same machine and OpenOCD is not running so as not to conflict with the st-link access.</p>
<p >Navigate into the <code>STM32CubeProgrammer/bin</code> directory and run the following: </p><pre class="fragment">./STM32_Programmer_CLI -c port=swd -startfus
./STM32_Programmer_CLI -c port=swd -fwdelete
</pre><p> If all the operations were successful the value of the <code>SFSA</code> register (which defines the start of the flash address space that is protected for CPU2 use) should now be <code>0xF4</code>. This can be checked by running: </p><pre class="fragment">./STM32_Programmer_CLI -c port=swd -ob displ
</pre> <h2><a class="anchor" id="autotoc_md68"></a>
Launching GDB</h2>
<p >The GNU Project debugger (GDB) is an application allows us to program and debug an application. We will just be using it to program and run the application.</p>
<p >First of all, follow the instructions in <a class="el" href="GETTING_STARTED.html#GETTING_STARTED_DEV_PC_SETUP">Development PC setup</a> to ensure that the correct ARM toolchain bin directory is in your path.</p>
<p >To verify that the correct ARM toolchain is in the path, execute the following command: </p><pre class="fragment">which arm-none-eabi-gdb
</pre><p> If you have followed the instructions in <a class="el" href="GETTING_STARTED.html#GETTING_STARTED_DEV_PC_SETUP">Development PC setup</a> then the result of this command should be as follows: </p><pre class="fragment">/opt/morse/gcc-arm-none-eabi-10.3-2021.07/bin/arm-none-eabi-gdb
</pre><p> Once OpenOCD and Miniterm are running, as described in the previous sections, it is possible to then launch GDB to program the device.</p>
<p >Ensure you are in the same directory where the <code>make</code> command was run to build the application (see <a class="el" href="GETTING_STARTED.html#BUILDING_FIRMWARE">Building Firmware</a> &ndash; for example, <code>mm-iot-sdk-&lt;VER&gt;/examples/&lt;example_name&gt;/targets/&lt;target_name&gt;</code>) and invoke: </p><pre class="fragment">arm-none-eabi-gdb build/ping.elf -ex 'target extended-remote :3333'
</pre><p> This will start GDB and connect to the local OpenOCD instance started above.</p>
<p >From the GDB terminal first reset and halt the device by executing: </p><pre class="fragment">monitor reset halt
</pre><p> Then download firmware by executing: </p><pre class="fragment">load
</pre><p> Once the firmware download has completed, the processor can be started by executing: </p><pre class="fragment">continue
</pre><p> As the firmware runs, it will boot the Morse Micro transceiver and attempt to connect to the AP and ping it. A successful result will output something like the following in Miniterm:</p>
<p >Note: This firmware has been built with debug in stop mode enabled. This will impact power consumption and should be disabled for production firmware. </p><pre class="fragment">Morse Ping Demo (Built Oct 10 2024 09:36:50)

-----------------------------------
BCF API version:         6.7.0
BCF build version:       4cdf808 07f9d31
BCF board description:   MM_LP3
Morselib version:        2.6.1
Morse firmware version:  1.13.1
Morse chip ID:           0x0306
-----------------------------------
Initialize IPv4 with static IP: 192.168.1.2...
Initialize IPv6 using Autoconfig...
Morse LwIP interface initialised. MAC address 0c:bf:74:00:01:2b
Attempting to connect to MorseMicro with passphrase 12345678
This may take some time (~30 seconds)
WLAN STA connecting
WLAN STA connected
Link is up. Time: 8294 ms, IP: 192.168.1.2, Netmask: 255.255.255.0, Gateway: 192.168.1.1

Ping 192.168.1.1 56(64) bytes of data.
(192.168.1.1) packets transmitted/received = 1/1, round-trip min/avg/max = 34/34/34 ms
(192.168.1.1) packets transmitted/received = 2/2, round-trip min/avg/max = 4/19/34 ms
(192.168.1.1) packets transmitted/received = 3/2, round-trip min/avg/max = 4/19/34 ms
(192.168.1.1) packets transmitted/received = 3/3, round-trip min/avg/max = 4/17/34 ms
(192.168.1.1) packets transmitted/received = 4/3, round-trip min/avg/max = 4/17/34 ms
(192.168.1.1) packets transmitted/received = 4/4, round-trip min/avg/max = 4/15/34 ms
(192.168.1.1) packets transmitted/received = 5/5, round-trip min/avg/max = 1/12/34 ms
(192.168.1.1) packets transmitted/received = 6/6, round-trip min/avg/max = 1/11/34 ms
(192.168.1.1) packets transmitted/received = 7/6, round-trip min/avg/max = 1/11/34 ms
(192.168.1.1) packets transmitted/received = 7/7, round-trip min/avg/max = 1/11/34 ms
(192.168.1.1) packets transmitted/received = 8/7, round-trip min/avg/max = 1/11/34 ms
(192.168.1.1) packets transmitted/received = 8/8, round-trip min/avg/max = 1/11/34 ms
(192.168.1.1) packets transmitted/received = 9/8, round-trip min/avg/max = 1/11/34 ms
(192.168.1.1) packets transmitted/received = 9/9, round-trip min/avg/max = 1/11/34 ms
(192.168.1.1) packets transmitted/received = 10/9, round-trip min/avg/max = 1/11/34 ms
(192.168.1.1) packets transmitted/received = 10/10, round-trip min/avg/max = 1/12/34 ms

--- 192.168.1.1 ping statistics ---
10 packets transmitted, 10 packets received, 0.000% packet loss
round-trip min/avg/max = 1/12/34 ms
WLAN STA disabled
Link is down. Time: 28727 ms
</pre><p >To halt the firmware press CTRL-C and to exit GDB from there press CTRL-D and enter <code>y</code> when prompted.</p>
<p >From here you can try out the other <a class="el" href="MMAPPS.html">Example Applications</a>.</p>
<h1><a class="anchor" id="autotoc_md69"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="BCF_CONFIG_STORE"></a>
Unable to find BCF file entry in config store</h2>
<h3><a class="anchor" id="autotoc_md70"></a>
Symptom</h3>
<p >The following message in the console log... </p><pre class="fragment">Unable to find BCF file entry in config store (memory range 0x81e0000-0x8200000)
Please see the Getting Started Guide for more information.
</pre> <h3><a class="anchor" id="autotoc_md71"></a>
Possible cause</h3>
<p >The above message will be displayed if a Morse Micro Board Configuration File (BCF file) file has not been programmed to the config store. See <a class="el" href="GETTING_STARTED.html#SET_APP_CONFIGURATION">Setting Application Configuration</a> for steps on how to do this.</p>
<h2><a class="anchor" id="autotoc_md72"></a>
Unable to connect to the MCU with OpenOCD</h2>
<h3><a class="anchor" id="autotoc_md73"></a>
Symptom</h3>
<p >You are unable to connect to the MCU when you run the 'openocd -f openocd.cfg' commands.</p>
<p >This may look like one of the following</p>
<pre class="fragment">% openocd -f openocd.cfg
xPack OpenOCD x86_64 Open On-Chip Debugger 0.12.0+dev-01312-g18281b0c4-dirty (2023-09-04-22:31)
Licensed under GNU GPL v2
For bug reports, read
    http://openocd.org/doc/doxygen/bugs.html
Info : The selected transport took over low-level target control. The results might differ compared to plain JTAG/SWD
Info : DEPRECATED target event trace-config; use TPIU events {pre,post}-{enable,disable}
Info : Listening on port 6666 for tcl connections
Info : Listening on port 4444 for telnet connections
Info : clock speed 500 kHz
Info : STLINK V3J8M3 (API v3) VID:PID 0483:374E
Info : Target voltage: 0.003198
Error: target voltage may be too low for reliable debugging
Error: init mode failed (unable to connect to the target)



% openocd -f openocd.cfg
xPack OpenOCD x86_64 Open On-Chip Debugger 0.12.0+dev-01312-g18281b0c4-dirty (2023-09-04-22:31)
Licensed under GNU GPL v2
For bug reports, read
    http://openocd.org/doc/doxygen/bugs.html
Info : The selected transport took over low-level target control. The results might differ compared to plain JTAG/SWD
Info : DEPRECATED target event trace-config; use TPIU events {pre,post}-{enable,disable}
Info : Listening on port 6666 for tcl connections
Info : Listening on port 4444 for telnet connections
Info : clock speed 500 kHz
Info : STLINK V3J8M3 (API v3) VID:PID 0483:374E
Info : Target voltage: 3.303398
Error: init mode failed (unable to connect to the target)
</pre><h3><a class="anchor" id="autotoc_md74"></a>
Possible cause 1</h3>
<p >The voltage (VDD) or current measurement (IDD) jumpers are not attached on your development board.</p>
<p >For the ST Nucleo U575 development board VDD is JP4 and IDD is JP5. See <a class="el" href="MMPLATFORMS.html">Morse Micro IoT Reference Platforms</a> for details of your specific platform.</p>
<h3><a class="anchor" id="autotoc_md75"></a>
Possible cause 2</h3>
<p >The ST-Link debugger is unable to communicate with the host processor because it is in deep sleep. It may be necessary to hold the chip in reset while attaching to it. This can be achieved by adding <code>-c "set CONNECT_ASSERT_SRST 1"</code> to the OpenOCD command line before including <code>openocd.cfg</code>. For example: </p><pre class="fragment">% openocd -c "set CONNECT_ASSERT_SRST 1" -f openocd.cfg
</pre><p> See <a class="el" href="MMHOSTPOWERSAVE.html#MMHOSTPOWERSAVE_DEBUG_DEEP_SLEEP">Debugging during deep sleep</a> for more information. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Copyright 2021 Morse Micro </li>
  </ul>
</div>
</body>
</html>
